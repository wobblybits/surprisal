<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Coiny&family=Fredoka:wght@300..700&family=Major+Mono+Display&family=Noto+Sans:ital,wght@0,100..900;1,100..900&family=Offside&family=Silkscreen:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/styles.css">
    <title>Surprisal Calculator</title>
    
    <!-- Favicon links -->
    <link rel="icon" type="image/x-icon" href="../assets/favicons/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="../assets/favicons/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../assets/favicons/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../assets/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="../assets/favicons/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="../assets/favicons/android-chrome-512x512.png">
    <meta name="theme-color" content="#ffffff">
    <script src="https://unpkg.com/tone"></script>
    <script type="module">
      import { SurprisalApp } from "../assets/js/surprisal-app.js";

      window.onload = () => {
        const app = new SurprisalApp();
        app.init();
        
        // Make rotation overlay dismissible
        const rotationOverlay = document.getElementById('rotation-overlay');
        if (rotationOverlay) {
          rotationOverlay.addEventListener('click', () => {
            rotationOverlay.classList.add('hidden');
          });
        }
      };
    </script>
  </head>
  <body>
    <!-- NEW: Rotation overlay for portrait mobile -->
    <div id="rotation-overlay">
      <div class="icon-wrapper">
        <img class="icon" src="../assets/images/sticker.png" alt="Rotate device">
      </div>
      <h2>Rotate Device</h2>
      <p>This calculator works best in landscape orientation for optimal button size and visibility.</p>
      <small>You can still use it in portrait, but the experience will be better rotated.</small>
      <small style="margin-top: 1rem; opacity: 0.6;">Tap anywhere to dismiss</small>
    </div>
    
    <div id="header-links">
      <a href="https://github.com/wobblybits/surprisal" target="_blank" rel="noopener" class="header-link" aria-label="View on GitHub">
        <img src="https://img.shields.io/github/stars/wobblybits/surprisal?style=social" alt="GitHub stars" class="star-badge">
      </a>
      <script async defer src="https://www.recurse-scout.com/loader.js?t=62e333ccfa9ade523f73c9755aa46503"></script>
    </div>
    
    <!-- NEW: Viewport wrapper around container -->
    <div id="viewport">
      <div id="container">
        <div id="calculator">
          <div id="title">WM7<span style="font-size: .8em; font-family: portfolio">±</span>2</div>
          <div id="display">
            <div id="indicator"></div> 
            <textarea id="user-input" placeholder="Enter text here..."></textarea>
          </div>
          <div id="buttons">
            <div id="scales"></div>
            <div id="models"></div>
            <div id="instruments"></div>
            <div id="translate">
              <div id="submit">Compose ♫</div>
            </div>
          </div>
        </div>
        <div id="keyboard"></div>
      </div>
    </div>
    
    <div id="explainer">
      <h1 id="heading">
        The Surprisal Calculator WM7±2
      </h1>
      <h4>Made by David Feil and Elise Kim during a batch at the <a href="https://www.recurse.com" target="_blank">Recurse Center</a>.</h4>

        <p>On this page, we invite you to experiment with the <strong>Surprisal Calculator WM 7±2</strong>, a tool developed to turn the flow of information in human language into melodies. According to <strong>surprisal theory</strong>, the more surprising a sentence is, the longer it takes for the human brain to understand. To see this in action, consider the two sentences below:</p> 

        <div id="examples">
          <div class="example-wrapper">
            <div id="ex1" class="example"> CLICK: sentence 1</div>
            <div id="ex1_hidden" class="example hiding"> The man fed the <strong>cat</strong> some tuna.</div>
          </div>
          <div class="example-wrapper">
            <div id="ex2" class="example"> CLICK: sentence 2</div>
            <div id="ex2_hidden" class="example hiding"> The lawyer presented the <strong>cat</strong> with a lawsuit.</div>
          </div>
        </div>

        <p>Even though the word <em>cat</em> appears in both sentences, it's far more surprising in the context of the second sentence. Odds are that the second sentence also took you longer to process.</p>
        <p>This seemingly fuzzy notion of "surprisingness" can actually be quantified using a formula first developed by Claude Shannon, the father of information theory. An event's surprisal is calculated as the negative log probability of that event happening in its given context. Applied to language, each word is an event, and the context is the sentence it appears in. Large language models, like GPT, provide a convenient way to calculate word probabilities in context.</p>
        <div id="equation">
          Surprisal(x) = -log<sub>2</sub> P(x | context)
        </div>
        <p>Coming back to our examples: in sentence 1, <em>cat</em> has a low surprisal value, because it appears in a sentence where talking about cats is very probable. In sentence 2, <em>cat</em> has a high surprisal value, because lawyers giving cats lawsuits is improbable.</p>

        <p>Surprisal is a fascinating way to measure how the human brain handles unpredictability in language. However, surprisal numbers aren't very intuitive to understand on their own. With the <strong>Surprisal Calculator WM 7±2</strong>, you can now input any sentence and hear its surprisal values translated to pitch intervals: a low pitch indicates low surprisal, and a high pitch indicates high surprisal.</p> 

        <div id="demo-wrapper">
          <div id="ex1_demo"> CLICK to hear sentence 1</div>
          <div id="ex2_demo"> CLICK to hear sentence 2</div>
        </div>

        <p>The decision to translate surprisal numbers to musical pitches was not arbitrary. A good, informative sentence is made from a blend of predictability (low surprisal) and spontaneity (high surprisal); the same could also be said of a good melody. We quickly bore of a sentence made only of repetitive, predictable words ("he said that he thought that she said that they think that…"), we also quickly bore of a melody made of the same note, repeated over and over again. The delicate balancing act of predictability and spontaneity that plays out in both language and music seems to hint at a shared cognitive architecture used in both forms of expression.</p>
        <h1 id="how-to-use-the-surprisal-calculator-wm-72">How to use the
        Surprisal Calculator</h1>
        <ul>
        <li><p>Type any sentence in, and press <code>compose</code> to hear its surprisal values.</p></li>
        <li><p>Use the calculator buttons to adjust instrument type, the LLM used to calculate probability scores, and the scale used to match surprisal numbers to pitches.</p></li>
        <li><p>Try typing the beginning of a sentence, then clicking keys on the keyboard. This will generate text with the surprisal values corresponding to the key pitch: experiment with what a very low surprisal or very high surprisal sentence sounds like. We suggest playing a common melody on the keyboard ("jingle bells" is a good candidate). Good melodies, which balance repetition with variety, tend to generate good sentences.</p></li>
        <li><p>You can also use the numbers 1-9 on your keyboard to play notes in the selected scale.</p></li>
      </ul>
        
        <h1>Sources and Code</h1>
        <p>This project is open source. For the purposes of this demo, we have only made one model available in the calculator, but you can download the source code and run it with whatever combination of models you would like!</p>
        <p>
          <a href="https://github.com/wobblybits/surprisal" target="_blank" rel="noopener" class="github-repo-badge">
            <svg class="github-badge-icon" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 0C5.374 0 0 5.373 0 12 0 17.302 3.438 21.8 8.207 23.387c.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0 1 12 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/>
            </svg>
            <span class="repo-path">wobblybits/surprisal</span>
          </a>
          (source code)
        </p>
        <p><a href="https://aclanthology.org/2023.tacl-1.82/">Testing the Predictions of Surprisal Theory in 11 Languages</a> (Wilcox et al., TACL 2023)</p>

        <p><a href="https://doi.org/10.1016/j.cognition.2007.05.006"> Expectation-based syntactic comprehension</a> (Levy, Cognition 2008)</p>
        <p><a href="https://doi.org/10.1002/j.1538-7305.1948.tb01338.x">A mathematical theory of communication</a> (Shannon, 1948)</p>

        <h1>Assets & Models</h1>
        <p><a href="https://huggingface.co/gpt2">GPT2</a>: The smallest (124M parameters) version of the official open-sourced GPT-2 models released from OpenAI.</p>
        <p><a href="https://huggingface.co/distilbert/distilgpt2">DistilGPT2</a>: An English-language model (88.2M parameters) pre-trained with the supervision of the smallest version of Generative Pre-trained Transformer 2 (GPT-2).</p>
        <p><a href="https://huggingface.co/HuggingFaceTB/SmolLM-135M">SmolLM</a>: The smallest (135M parameters) of the three models in the SmolLM series of state-of-the-art small language models developed by the Hugging Face research team. These models are built on Cosmo-Corpus, a meticulously curated high-quality training dataset.</p>
        <p><a href="https://huggingface.co/crumb/nano-mistral">Nano Mistral</a>: A small (170M parameters) Mistral model built for general web text completion at extremely low resource use.</p>
        <p><a href="https://huggingface.co/KingNish/Qwen2.5-0.5b-Test-ft">Qwen 2.5</a>: A compact yet powerful language model (494M parameters) trained on a subset of the Magpie 300k Database to answer a variety of questions</p>
        <p><a href="https://huggingface.co/google/flan-t5-small">Flan T5</a>: Google's super small (74M parameters)version of the Text-To-Text Transfer Transformer (T5) model, fine-tuned on more than 1000 additional tasks (and more languages!).</p>
        <p>Calculator display font is <a href="https://int10h.org/oldschool-pc-fonts/fontlist/font?portfolio_6x8#-">Portfolio 6x8</a> from the <a href="https://int10h.org/oldschool-pc-fonts/">Old School PC Fonts project</a></p>
        <p>Calculator button font is <a href="https://fonts.google.com/specimen/Fredoka">Fredoka</a> by <a href="https://milenabrandão.com/">Milena Brandão</a></p>
        <p>Instrument icons by <a href="https://www.flaticon.com/authors/ains">Ains</a> and <a href="https://www.flaticon.com/authors/iconpack">IconPack</a> at <a href="https://www.flaticon.com/">Flaticon</a></p>
        <p>Sounds generated with <a href="https://tonejs.github.io/">Tone.js</a></p>
        <p>Cat <a href="https://pixabay.com/sound-effects/cat-meow-8-fx-306184/">sound effect</a> by <a href="https://buymeacoffee.com/bfcmusic">bfcmusic</a></p>
        <p>Cat playing with knitting yarn adapted from <a href="https://www.flaticon.com/free-icons/cat-playing-with-knitting-yarn" title="cat playing with knitting yarn icons">icons</a> created by <a href="https://www.flaticon.com/authors/kerismaker">kerismaker</a> at  <a href="https://www.flaticon.com/">Flaticon</a></p>
    </div>
    <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "f553c28599a74dbf80c13e7b77d31cec"}'></script>
  </body>
</html>